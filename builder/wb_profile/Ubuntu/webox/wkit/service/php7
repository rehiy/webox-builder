APP_BIN_START='/srv/php7/sbin/php-fpm'

APP_PID_FILE='/srv/php7/var/run/fpm.pid'

APP_SIG_STOP='TERM'

APP_SIG_RELOAD='USR2'


app_once() {

    grep www-data /etc/group > /dev/null
    if [ $? -ne 0 ]; then
        groupadd www-data -g 33
    fi

    grep www-data /etc/passwd > /dev/null
    if [ $? -ne 0 ]; then
        useradd www-data -u 33 -g 33
        usermod www-data -d /srv/webroot -s /usr/sbin/nologin
    fi

    mkdir -p /srv/php7/var/{run,log,tmp}
    mkdir -p /srv/php7/var/tmp/{upload,session}
    chown -R www-data:www-data /srv/php7/var/*

}

app_init() {

    local poolvar poolconfig

    for poolconfig in /srv/php7/etc/fpm.d/*.inc; do

        poolvar=${poolconfig##*/}
        poolvar=/srv/webroot/${poolvar/.inc/}/var

        mkdir -p $poolvar/upload $poolvar/session
        chown -R www-data:www-data $poolvar

    done

}
