#!/bin/bash
#

if [ -f $(pwd)/config ]; then
    source $(pwd)/config
fi

if [ -z ${wkdir} ]; then
    echo "Please use './wk_complie' to run this script"
    exit 1
fi

source ${wkdir}/function

#################################################################Package#

for pkg in ${wkdir}/library/*; do
    source ${pkg}
done

for pkg in ${wkdir}/app/*; do
    source ${pkg}
done

wk_inst_webox

wk_inst_mysql
wk_inst_redis

wk_inst_nginx

wk_inst_php5
wk_inst_php7

#################################################################Profile#

rm -rf ${wbapp}/etc/nginx
rm -rf ${wbapp}/etc/php*
cp -av ${wketc}/* /srv/

chown -R 0:0  /srv
chmod -R 0755 ${wbcom}/bin
chmod -R 0755 /srv/service
chmod -R 0755 /srv/htdoc/*

find ${wbapp}/etc ! \( -uid 0 -gid 0 \) -exec chown 0:0 {} \;
find ${wbapp}/etc \( ! -perm 0644 -type f \) -exec chmod 0644 {} \;
find ${wbapp}/etc \( ! -perm 0755 -type d \) -exec chmod 0755 {} \;
