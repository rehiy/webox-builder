#!/bin/bash
#

if [ -f $(pwd)/config ]; then
    source $(pwd)/config
fi

if [ -z ${wbdir} ]; then
    echo "Please use './wk_complie' to run this script"
    exit 1
fi

source ${wbdir}/function

#################################################################Package#

for pkg in ${wbdir}/library/*; do
    [ -x ${pkg} ] && source ${pkg}
done

for pkg in ${wbdir}/app/*; do
    [ -x ${pkg} ] && source ${pkg}
done

wb_inst_webox

wb_inst_php5
wb_inst_php7

wb_inst_nginx

wb_inst_mysql
wb_inst_redis

#################################################################Profile#

cp -av ${wbetc}/* /srv/

chown -R 0:0  /srv
chmod -R 0755 /srv/service
chmod -R 0755 /srv/webox/bin/wkit
chmod -R 0755 /srv/webox/wkit
chmod -R 0755 /srv/webroot/*

find /srv/*/etc ! \( -uid 0 -gid 0 \) -exec chown 0:0 {} \;
find /srv/*/etc \( ! -perm 0644 -type f \) -exec chmod 0644 {} \;
find /srv/*/etc \( ! -perm 0755 -type d \) -exec chmod 0755 {} \;
