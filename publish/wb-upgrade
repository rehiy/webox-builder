#!/bin/sh
#

cd ~

name=Webox-$(uname -s)-$(uname -m).tgz

if type wget >/dev/null; then
    wget -c -O ${name} http://get.vmlu.com/webox/${name}
else
    curl -C - -o ${name} http://get.vmlu.com/webox/${name}
fi

echo "Updating with ${name}"
tar -xf ${name} && rm ${name}

if [ ! -d ~/srv/webox ]; then
    echo "Can't download ${name}"
    exit 1
fi

####################################################################

[ -x /srv/service ] && /srv/service stop

rm -rf /var/lib/webox

cp -au ~/srv/* /srv/
rm -rf ~/srv/

####################################################################

[ -x /srv/service ] && /srv/service start
